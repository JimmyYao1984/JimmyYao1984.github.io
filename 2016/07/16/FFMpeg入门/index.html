<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>FFMpeg入门 | Jimmy的日记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述ffplay文件概览
libavcodec
allcodecs.c 简单的注册类函数
avcodec.h 编解码相关结构定义和函数原型声明
dsputil.c 限幅数组初始化
dsputil.h 限幅数组声明
imgconvert.c 颜色空间转换相关函数实现
imgconvert_template.h 颜色空间转换相关结构体定义和函数实现
msrle.c 视频RLE行程长度压缩算法解码库
t">
<meta property="og:type" content="article">
<meta property="og:title" content="FFMpeg入门">
<meta property="og:url" content="http://JimmyYao984.github.io/2016/07/16/FFMpeg入门/index.html">
<meta property="og:site_name" content="Jimmy的日记">
<meta property="og:description" content="概述ffplay文件概览
libavcodec
allcodecs.c 简单的注册类函数
avcodec.h 编解码相关结构定义和函数原型声明
dsputil.c 限幅数组初始化
dsputil.h 限幅数组声明
imgconvert.c 颜色空间转换相关函数实现
imgconvert_template.h 颜色空间转换相关结构体定义和函数实现
msrle.c 视频RLE行程长度压缩算法解码库
t">
<meta property="og:image" content="http://7xvn7e.com1.z0.glb.clouddn.com/ffpeg_struct.png">
<meta property="og:image" content="http://7xvn7e.com1.z0.glb.clouddn.com/directshow.png">
<meta property="og:updated_time" content="2016-07-21T03:23:41.253Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FFMpeg入门">
<meta name="twitter:description" content="概述ffplay文件概览
libavcodec
allcodecs.c 简单的注册类函数
avcodec.h 编解码相关结构定义和函数原型声明
dsputil.c 限幅数组初始化
dsputil.h 限幅数组声明
imgconvert.c 颜色空间转换相关函数实现
imgconvert_template.h 颜色空间转换相关结构体定义和函数实现
msrle.c 视频RLE行程长度压缩算法解码库
t">
<meta name="twitter:image" content="http://7xvn7e.com1.z0.glb.clouddn.com/ffpeg_struct.png">
  
    <link rel="alternate" href="/atom.xml" title="Jimmy的日记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jimmy的日记</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">study new skill step by step</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://JimmyYao984.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-FFMpeg入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/16/FFMpeg入门/" class="article-date">
  <time datetime="2016-07-16T07:27:11.000Z" itemprop="datePublished">2016-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      FFMpeg入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h4 id="ffplay文件概览"><a href="#ffplay文件概览" class="headerlink" title="ffplay文件概览"></a>ffplay文件概览</h4><p><img src="http://7xvn7e.com1.z0.glb.clouddn.com/ffpeg_struct.png" alt="Mark-Down"></p>
<h5 id="libavcodec"><a href="#libavcodec" class="headerlink" title="libavcodec"></a>libavcodec</h5><ul>
<li>allcodecs.c 简单的注册类函数</li>
<li>avcodec.h 编解码相关结构定义和函数原型声明</li>
<li>dsputil.c 限幅数组初始化</li>
<li>dsputil.h 限幅数组声明</li>
<li>imgconvert.c 颜色空间转换相关函数实现</li>
<li>imgconvert_template.h 颜色空间转换相关结构体定义和函数实现</li>
<li>msrle.c 视频RLE行程长度压缩算法解码库</li>
<li>truespeech.c 语音TrueSpeech算法解码库</li>
<li>truespeech_data.h 语音TrueSpeech算法解码常量数组</li>
<li>utils_codec.c 一些解码相关的工具类函数的实现</li>
</ul>
<h5 id="libavformat"><a href="#libavformat" class="headerlink" title="libavformat"></a>libavformat</h5><ul>
<li>allformats.c 简单注册类函数</li>
<li>avformat.h 文件和媒体格式相关结构体定义和函数原型声明</li>
<li>avidec.c AVI文件解析类函数</li>
<li>avio.c 无缓冲数据IO相关函数实现</li>
<li>avio.h 无缓冲数据IO相关结构体定义和函数实现</li>
<li>aviobuf.c 有缓冲数据IO相关函数实现</li>
<li>cutils.c 两个简单的字符串操作函数</li>
<li>file.c 文件IO相关函数</li>
<li>utils_format.c 文件和媒体格式相关的工具类函数的实现</li>
</ul>
<h5 id="libavutil"><a href="#libavutil" class="headerlink" title="libavutil"></a>libavutil</h5><ul>
<li>avutil.h 简单的像素格式宏定义</li>
<li>bswap.h 简单的大小端转换函数的实现</li>
<li>common.h 公共的宏定义和简单函数的实现</li>
<li>mathematics.h 一个简单的数学运算函数(A*B/C)</li>
<li>rational.h 用两整数表示分数相关函数</li>
</ul>
<p>berrno.h 错误码定义<br>ffplay.c 总控文件</p>
<h4 id="播放器一般原理"><a href="#播放器一般原理" class="headerlink" title="播放器一般原理"></a>播放器一般原理</h4><p>七个模块按广度顺序：读文件模块、解复用模块、视频解码模块、音频解码音频、颜色空间转换模块、视频显示模块，音频播放模块。<br><img src="http://7xvn7e.com1.z0.glb.clouddn.com/directshow.png" alt="Mark-Down"></p>
<p>播放器有关的filter粗略的分为五类，分别是SourceFilter,DemuxFilter,DecoderFilter,ColorSpaceConverterFilter, RenderFilter。<br>SourceFilter源过滤器的作用是为下级DemuxFilter以包的形式源源不断的提供数据流。在通常情况下，我们有多种方式可以获得数据流，一种是从本地文件中读取，一种是从网上获取，SourceFilter另外一个作用就是屏蔽读本地文件和获取网络数据的差别，在下一级的DemuxFilter看来，本地文件和网络数据是一样的。<br>DemuxFilter解复用过滤器的作用是识别文件类型，媒体类型，分离出各媒体原始数据流，打上时钟信息后送给下级DecodeFilter。为识别出不同的文件类型和媒体类型，常规的做法是读取一部分数据，然后遍历解复用过滤器支持的文件格式和媒体数据格式，做匹配来确定是哪种文件类型，哪种媒体类型；有些媒体类型的原始数据外面还有其他的信息，比如时间、包大小、是否完整包等等。DemuxFilter解析数据包后取出原始数据，有些类型的媒体不管是否是完整包都立即送往下级DecodeFilter，有些类型的媒体要送完整数据包，此时可能有一些数据包拼接的动作；当然时钟信息的计算也是DemuxFilter的工作内容，这个时钟用于各媒体之间的同步。在本例中，AVISplitter是DemuxFilter。<br>DecoderFilter解码过滤器的作用就是解码数据包，并且把同步时钟信息传递下去。对视频媒体而言，通常是解码成YUV数据，然后利用显卡硬件直接支持YUV格式数据Overlay快速显示的特性让显卡极速显示。YUV格式是一个统称，常见的有YV12、YUY2，UYVY等等。有些非常古老的显卡和嵌入式系统不支持YUV数据显示，那就要转换成RGB格式的数据，每一帧的每一个像素点都要转换，分别计算RGB分量，并且因为转换是浮点运算，虽然有定点算法，还是要耗掉相当一部分CPU，总体上效率底下；对音频媒体而言，通常是解码成PCM数据，然后送给声卡直接输出。在本例中，AVI Decompress和ACM Warper是DecoderFilter。<br>ColorSpaceConverterFilter颜色空间转换过滤器的作用是把视频解码器解码出来的数据转换成当前显示系统支持的颜色格式。通常视频解码器解码出来的是YUV数据，PC系统是直接支持YUV格式的，也支持RGB格式，有些嵌入式系统只支持RGB格式的。在本例中，视频解码器出来的是RGB8格式的数据，ColorSpaceConverterFilter把RGB8转换成RGB32显示。<br>RenderFilter渲染过滤器的作用就是在适当的时间渲染相应的媒体，对视频媒体就是直接显示图像，对音频就是播放声音。视音频同步的策略方法有好几种，其中最简单的一种就是默认视频和音频基准时间相同，这时音频可以不打时钟信息，通过计算音频的采样频率，量化bit数，声道数等基本参数就知道音频PCM的数据速率，按照这个速率往前播放即可；视频必须要使用同步时钟信息来决定什么时候显示。DirectShow采用一个有序链表，把接收到的数据包放进有序链表中，启动一个定时器，每次定时器时间到就扫描链表，比较时钟信息，或者显示相应的帧，或者什么也不做，每次接收到新的数据帧，首先判断时钟信息，如果是历史数据帧就丢弃，如果是将来显示数据帧就进有序链表，如果当前时间帧就直接显示。如此这样，保持视频和音频在人体感觉误差范围内相对的动态同步。在本例中VideoRendeDirectSoundDevice是RenderFilter，同时也是SinkFilter。<br>GraphEdit应用程序可以看成是一个支撑平台，支撑框架。它容纳各种Filter，在Filter间的传递一些通讯消息，控制Filter的运行（启动暂停停止），维护Filter运行状态。GraphEdit就像超级大管家一样，既维护管理看得见的Filter，又维护管理看不见的运行支撑环境。</p>
<h4 id="ffplay播放器原理"><a href="#ffplay播放器原理" class="headerlink" title="ffplay播放器原理"></a>ffplay播放器原理</h4><h4 id="ffplay架构概述"><a href="#ffplay架构概述" class="headerlink" title="ffplay架构概述"></a>ffplay架构概述</h4><h4 id="ffplay主要改动"><a href="#ffplay主要改动" class="headerlink" title="ffplay主要改动"></a>ffplay主要改动</h4><h4 id="SDL显示视频"><a href="#SDL显示视频" class="headerlink" title="SDL显示视频"></a>SDL显示视频</h4><h4 id="SDL播放音频"><a href="#SDL播放音频" class="headerlink" title="SDL播放音频"></a>SDL播放音频</h4><h4 id="AVI文件格式简介"><a href="#AVI文件格式简介" class="headerlink" title="AVI文件格式简介"></a>AVI文件格式简介</h4><h4 id="MS-RLE压缩算法简介"><a href="#MS-RLE压缩算法简介" class="headerlink" title="MS RLE压缩算法简介"></a>MS RLE压缩算法简介</h4><h4 id="True-Speech压缩算法简介"><a href="#True-Speech压缩算法简介" class="headerlink" title="True Speech压缩算法简介"></a>True Speech压缩算法简介</h4><p><br><br><br><br></p>
<h2 id="libavutil剖析"><a href="#libavutil剖析" class="headerlink" title="libavutil剖析"></a>libavutil剖析</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://JimmyYao984.github.io/2016/07/16/FFMpeg入门/" data-id="cius4sg1u0004i4gf36wdr5i9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/21/Java注解/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Java注解
        
      </div>
    </a>
  
  
    <a href="/2016/06/27/函数式编程/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">函数式编程</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/10/27/RBAC模型/">RBAC模型</a>
          </li>
        
          <li>
            <a href="/2016/09/16/安全加密认证基础知识/">安全加密认证基础知识</a>
          </li>
        
          <li>
            <a href="/2016/09/13/RX前传/">RX前传</a>
          </li>
        
          <li>
            <a href="/2016/08/08/源码分析OKHttp/">源码分析OKHttp</a>
          </li>
        
          <li>
            <a href="/2016/08/05/doc-ppt-online/">在线预览ppt doc</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jimmy Yao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>